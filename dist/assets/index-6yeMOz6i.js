(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))g(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const a of e.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&g(a)}).observe(document,{childList:!0,subtree:!0});function c(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?e.credentials="include":t.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function g(t){if(t.ep)return;t.ep=!0;const e=c(t);fetch(t.href,e)}})();const s={top:20,right:30,bottom:40,left:60},u={primary:"#38bdf8",secondary:"#818cf8",smoker:"#ef4444",nonSmoker:"#22c55e"};let p={data:[],width:0,height:0};async function b(){try{const i=await d3.csv("medical-charges.csv");p.data=i.map(o=>({...o,age:+o.age,bmi:+o.bmi,children:+o.children,charges:+o.charges,isSmoker:o.smoker==="yes"})),console.log("Data loaded:",p.data.length,"records"),L(),w(),v(),window.addEventListener("resize",()=>{v()})}catch(i){console.error("Error loading data:",i),alert("Failed to load medical-charges.csv. Please ensure the file is present.")}}function L(){const i=p.data.length,o=d3.mean(p.data,a=>a.charges),c=d3.mean(p.data,a=>a.bmi),t=p.data.filter(a=>a.isSmoker).length/i*100;[{id:"#total-patients",value:i,format:d3.format(",")},{id:"#avg-charge",value:o,format:d3.format("$,.2f")},{id:"#avg-bmi",value:c,format:d3.format(".1f")},{id:"#smoker-percent",value:t,format:a=>d3.format(".1f")(a)+"%"}].forEach(a=>{const m=document.querySelector(a.id),d={value:0};anime({targets:d,value:a.value,round:10,duration:2e3,easing:"easeOutExpo",update:()=>{m.innerText=a.format(d.value)}})})}function v(){$(),C(),B()}function $(){const i=document.getElementById("scatter-plot");i.innerHTML="";const{width:o,height:c}=i.getBoundingClientRect(),g=o-s.left-s.right,t=c-s.top-s.bottom,e=d3.select("#scatter-plot").append("svg").attr("width",o).attr("height",c).append("g").attr("transform",`translate(${s.left},${s.top})`),a=d3.select("body").append("div").attr("class","tooltip").style("opacity",0),m=d3.scaleLinear().domain(d3.extent(p.data,r=>r.bmi)).range([0,g]),d=d3.scaleLinear().domain([0,d3.max(p.data,r=>r.charges)]).range([t,0]),n=d3.scaleOrdinal().domain([!0,!1]).range([u.smoker,u.nonSmoker]);e.append("g").attr("transform",`translate(0,${t})`).attr("class","axis").call(d3.axisBottom(m).ticks(5)).call(r=>r.append("text").attr("x",g).attr("y",-5).attr("fill","#ccc").attr("text-anchor","end").text("BMI")),e.append("g").attr("class","axis").call(d3.axisLeft(d).tickFormat(d3.format("$.0s"))).call(r=>r.append("text").attr("x",5).attr("y",5).attr("fill","#ccc").attr("text-anchor","start").text("Charges")),e.selectAll("circle").data(p.data).enter().append("circle").attr("cx",r=>m(r.bmi)).attr("cy",r=>d(r.charges)).attr("r",4).attr("fill",r=>n(r.isSmoker)).attr("opacity",.7).on("mouseover",(r,h)=>{a.transition().duration(200).style("opacity",1),a.html(`
                <strong>BMI:</strong> ${h.bmi.toFixed(1)}<br/>
                <strong>Charges:</strong> ${d3.format("$,.2f")(h.charges)}<br/>
                <strong>Smoker:</strong> ${h.isSmoker?"Yes":"No"}<br/>
                <strong>Age:</strong> ${h.age}
            `).style("left",r.pageX+10+"px").style("top",r.pageY-28+"px"),d3.select(r.target).attr("r",8).attr("opacity",1)}).on("mouseout",r=>{a.transition().duration(500).style("opacity",0),d3.select(r.target).attr("r",4).attr("opacity",.7)});const f=document.getElementById("scatter-legend");f.innerHTML=`
        <div class="legend-item"><div class="legend-dot" style="background:${u.smoker}"></div>Smoker</div>
        <div class="legend-item"><div class="legend-dot" style="background:${u.nonSmoker}"></div>Non-Smoker</div>
    `,anime({targets:"#scatter-plot circle",scale:[0,1],opacity:[0,.7],easing:"easeOutElastic(1, .8)",duration:800,delay:anime.stagger(1)})}function C(){const i=document.getElementById("region-chart");i.innerHTML="";const{width:o,height:c}=i.getBoundingClientRect(),g=o-s.left-s.right,t=c-s.top-s.bottom,e=d3.select("#region-chart").append("svg").attr("width",o).attr("height",c).append("g").attr("transform",`translate(${s.left},${s.top})`),a=Array.from(d3.group(p.data,n=>n.region),([n,f])=>({region:n,value:d3.mean(f,r=>r.charges)})).sort((n,f)=>f.value-n.value),m=d3.scaleBand().range([0,g]).domain(a.map(n=>n.region)).padding(.3),d=d3.scaleLinear().domain([0,d3.max(a,n=>n.value)]).range([t,0]);e.append("g").attr("transform",`translate(0,${t})`).attr("class","axis").call(d3.axisBottom(m)),e.append("g").attr("class","axis").call(d3.axisLeft(d).tickFormat(d3.format("$.0s"))),e.selectAll("rect").data(a).enter().append("rect").attr("x",n=>m(n.region)).attr("y",t).attr("width",m.bandwidth()).attr("height",0).attr("fill",u.primary).attr("rx",4),anime({targets:"#region-chart rect",height:n=>t-d(n.__data__.value),y:n=>d(n.__data__.value),easing:"spring(1, 80, 10, 0)",duration:1e3,delay:anime.stagger(100)})}function B(){const i=document.getElementById("age-chart");i.innerHTML="";const{width:o,height:c}=i.getBoundingClientRect(),g=o-s.left-s.right,t=c-s.top-s.bottom,e=d3.select("#age-chart").append("svg").attr("width",o).attr("height",c).append("g").attr("transform",`translate(${s.left},${s.top})`),d=d3.bin().value(l=>l.age).thresholds([18,25,35,45,55,65])(p.data).map(l=>({x0:l.x0,x1:l.x1,avgCharge:d3.mean(l,k=>k.charges)||0})),n=d3.scaleLinear().domain([18,65]).range([0,g]),f=d3.scaleLinear().domain([0,d3.max(d,l=>l.avgCharge)]).range([t,0]);e.append("g").attr("transform",`translate(0,${t})`).attr("class","axis").call(d3.axisBottom(n).ticks(5)).append("text").attr("x",g/2).attr("y",35).attr("fill","#ccc").text("Age Groups"),e.append("g").attr("class","axis").call(d3.axisLeft(f).tickFormat(d3.format("$.0s")));const r=d3.area().curve(d3.curveMonotoneX).x(l=>n((l.x0+l.x1)/2)).y0(t).y1(l=>f(l.avgCharge)),h=e.append("path").datum(d).attr("fill","url(#gradient)").attr("stroke",u.secondary).attr("stroke-width",2).attr("d",r).attr("opacity",.8),x=e.append("defs").append("linearGradient").attr("id","gradient").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%");x.append("stop").attr("offset","0%").attr("stop-color",u.secondary).attr("stop-opacity",.6),x.append("stop").attr("offset","100%").attr("stop-color",u.secondary).attr("stop-opacity",0);const y=h.node().getTotalLength();h.attr("stroke-dasharray",y+" "+y).attr("stroke-dashoffset",y).transition().duration(1500).ease(d3.easeCubicOut).attr("stroke-dashoffset",0),h.attr("opacity",0).transition().delay(500).duration(1e3).attr("opacity",.8)}function w(){anime({targets:".enter-animation",translateY:[20,0],opacity:[0,1],delay:anime.stagger(100),duration:800,easing:"easeOutQuad"})}document.addEventListener("DOMContentLoaded",b);document.getElementById("refresh-btn").addEventListener("click",b);
